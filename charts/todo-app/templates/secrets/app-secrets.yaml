apiVersion: v1
kind: Secret
metadata:
  name: {{ include "todo-app.fullname" . }}-auth-secret
  {{- if .Values.namespace.name }}
  namespace: {{ .Values.namespace.name }}
  {{- else }}
  namespace: {{ .Release.Namespace }}
  {{- end }}
  labels:
    {{- include "todo-app.standard-labels" . | nindent 4 }}
    ai/managed: "true"
    ai/type: "authentication-secret"
    ai/discoverable: "false"
  annotations:
    ai/managed: "true"
    ai/type: "authentication-secret"
    ai/description: "Authentication secret for Better Auth"
    ai/discoverable: "false"
    kubernetes.io/service-account.name: {{ include "todo-app.fullname" . }}-auth-secret
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-weight": "-10"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
type: Opaque
data:
  auth-secret: {{ .Values.auth.secret | b64enc | quote }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "todo-app.fullname" . }}-db-secret
  {{- if .Values.namespace.name }}
  namespace: {{ .Values.namespace.name }}
  {{- else }}
  namespace: {{ .Release.Namespace }}
  {{- end }}
  labels:
    {{- include "todo-app.standard-labels" . | nindent 4 }}
    ai/managed: "true"
    ai/type: "database-secret"
    ai/discoverable: "false"
  annotations:
    ai/managed: "true"
    ai/type: "database-secret"
    ai/description: "Database connection secrets"
    ai/discoverable: "false"
    kubernetes.io/service-account.name: {{ include "todo-app.fullname" . }}-db-secret
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-weight": "-10"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
type: Opaque
data:
  database-url: {{ .Values.database.url | b64enc | quote }}
  postgres-password: {{ .Values.database.password | b64enc | quote }}
---
{{- if .Values.ai.coapiKey }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "todo-app.fullname" . }}-ai-secret
  {{- if .Values.namespace.name }}
  namespace: {{ .Values.namespace.name }}
  {{- else }}
  namespace: {{ .Release.Namespace }}
  {{- end }}
  labels:
    {{- include "todo-app.standard-labels" . | nindent 4 }}
    ai/managed: "true"
    ai/type: "ai-secret"
    ai/discoverable: "false"
  annotations:
    ai/managed: "true"
    ai/type: "ai-secret"
    ai/description: "AI service API keys"
    ai/discoverable: "false"
    kubernetes.io/service-account.name: {{ include "todo-app.fullname" . }}-ai-secret
    "helm.sh/hook": pre-install,pre-upgrade
    "helm.sh/hook-weight": "-10"
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
type: Opaque
data:
  cohere-api-key: {{ .Values.ai.coapiKey | b64enc | quote }}
{{- end }}